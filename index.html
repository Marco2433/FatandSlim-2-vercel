<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover, minimal-ui" />
        
        <!-- Cache Control - Force refresh -->
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        
        <!-- PWA Meta Tags -->
        <meta name="theme-color" content="#1a1a2e" />
        <meta name="background-color" content="#1a1a2e" />
        <meta name="description" content="Fat & Slim - Application de coaching sportif et nutritionnel avec IA. Perdez du poids, mangez mieux, améliorez votre forme." />
        
        <!-- Apple PWA Meta Tags for Fullscreen -->
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="apple-mobile-web-app-title" content="Fat & Slim" />
        <link rel="apple-touch-icon" href="/api/pwa/icon-192x192.png" />
        <link rel="apple-touch-icon" sizes="180x180" href="/api/pwa/icon-192x192.png" />
        <link rel="apple-touch-icon" sizes="152x152" href="/api/pwa/icon-152x152.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="/api/pwa/icon-144x144.png" />
        <link rel="apple-touch-icon" sizes="120x120" href="/api/pwa/icon-128x128.png" />
        
        <!-- Android/Chrome Fullscreen -->
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="application-name" content="Fat & Slim" />
        
        <!-- Microsoft PWA Meta Tags -->
        <meta name="msapplication-TileColor" content="#000000" />
        <meta name="msapplication-TileImage" content="/api/pwa/icon-144x144.png" />
        <meta name="msapplication-navbutton-color" content="#F472B6" />
        <meta name="msapplication-starturl" content="/" />
        <meta name="msapplication-tap-highlight" content="no" />
        
        <!-- Additional fullscreen helpers -->
        <meta name="screen-orientation" content="portrait" />
        <meta name="full-screen" content="yes" />
        <meta name="browsermode" content="application" />
        <meta name="nightmode" content="enable" />
        <meta name="layoutmode" content="fitscreen" />
        <meta name="imagemode" content="force" />
        
        <!-- Favicon -->
        <link rel="icon" type="image/png" sizes="32x32" href="/api/pwa/icon-96x96.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="/api/pwa/icon-48x48.png" />
        <link rel="shortcut icon" href="/api/pwa/icon-96x96.png" />
        
        <!-- Manifest -->
        <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
        
        <!-- Splash screens for iOS -->
        <link rel="apple-touch-startup-image" href="/api/pwa/icon-512x512.png" />
        
        <!-- Open Graph / Social -->
        <meta property="og:type" content="website" />
        <meta property="og:title" content="Fat & Slim - Coaching sportif et nutritionnel IA" />
        <meta property="og:description" content="Application de coaching sportif et nutritionnel avec IA. Perdez du poids, mangez mieux, améliorez votre forme." />
        <meta property="og:image" content="/api/pwa/icon-512x512.png" />
        
        <title>Fat & Slim - Coaching IA</title>
        
        <style>
            /* Force fullscreen PWA styles */
            html {
                height: 100%;
                overflow: hidden;
                position: fixed;
                width: 100%;
            }
            
            body {
                height: 100%;
                overflow: auto;
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: none;
                position: fixed;
                width: 100%;
                /* Safe area insets for notched devices */
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
            }
            
            #root {
                height: 100%;
                overflow: auto;
            }
            
            /* Hide scrollbar */
            ::-webkit-scrollbar {
                display: none;
            }
            
            body, #root {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            
            /* PWA standalone mode - hide browser UI */
            @media all and (display-mode: fullscreen),
                   all and (display-mode: standalone),
                   all and (display-mode: minimal-ui) {
                body {
                    padding-top: env(safe-area-inset-top) !important;
                }
            }
            
            /* iOS Safari specific fixes */
            @supports (-webkit-touch-callout: none) {
                body {
                    /* Prevent rubber-banding */
                    position: fixed;
                    overflow: hidden;
                }
                #root {
                    overflow: auto;
                    height: 100%;
                    -webkit-overflow-scrolling: touch;
                }
            }
        </style>
    </head>
    <body>
        <noscript>Vous devez activer JavaScript pour utiliser cette application.</noscript>
        <div id="root"></div>
        
        <!-- Service Worker Registration with cache clearing -->
        <script>
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('/sw.js')
                        .then(function(registration) {
                            console.log('ServiceWorker registration successful');
                            
                            // Check for updates
                            registration.update();
                            
                            // Listen for updates
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', () => {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        // New version available, notify user or auto-update
                                        console.log('New version available');
                                        newWorker.postMessage('skipWaiting');
                                    }
                                });
                            });
                        })
                        .catch(function(err) {
                            console.log('ServiceWorker registration failed: ', err);
                        });
                    
                    // Refresh all tabs when SW updates
                    let refreshing = false;
                    navigator.serviceWorker.addEventListener('controllerchange', () => {
                        if (!refreshing) {
                            refreshing = true;
                            window.location.reload();
                        }
                    });
                });
            }
            
            // iOS standalone mode detection
            if (window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches) {
                document.body.classList.add('pwa-standalone');
            }
        </script>
    </body>
</html>
